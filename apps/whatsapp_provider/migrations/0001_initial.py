# Generated by Django 5.2.7 on 2025-11-24 07:57

import django.db.models.deletion
import django.utils.timezone
from django.conf import settings
from django.db import migrations, models


class Migration(migrations.Migration):

    initial = True

    dependencies = [
        ('campaigns', '0002_initial'),
        ('customers', '0006_rename_customers_cu_channel_123abc_idx_customers_c_channel_d1da5f_idx'),
        migrations.swappable_dependency(settings.AUTH_USER_MODEL),
    ]

    operations = [
        migrations.CreateModel(
            name='WhatsAppProvider',
            fields=[
                ('id', models.BigAutoField(primary_key=True, serialize=False)),
                ('name', models.CharField(help_text='Friendly name for this provider', max_length=100)),
                ('provider_type', models.CharField(choices=[('meta', 'Meta Business API'), ('twilio', 'Twilio WhatsApp'), ('gupshup', 'Gupshup WhatsApp'), ('360dialog', '360Dialog')], default='meta', max_length=20)),
                ('credentials', models.JSONField(default=dict, help_text='Encrypted API credentials for the provider')),
                ('business_name', models.CharField(blank=True, max_length=255, null=True)),
                ('business_description', models.TextField(blank=True, null=True)),
                ('business_email', models.EmailField(blank=True, max_length=254, null=True)),
                ('business_vertical', models.CharField(blank=True, max_length=100, null=True)),
                ('business_address', models.TextField(blank=True, null=True)),
                ('enable_auto_reply', models.BooleanField(default=True, help_text='Enable automatic replies')),
                ('use_knowledge_base', models.BooleanField(default=True, help_text='Use RAG knowledge base for responses')),
                ('greeting_message', models.TextField(default="Hello! I'm your AI assistant. How can I help you today?", help_text='Welcome message for new conversations')),
                ('fallback_message', models.TextField(default="I'm sorry, I didn't understand that. Could you please rephrase your question?", help_text="Message when AI can't understand the query")),
                ('enable_business_hours', models.BooleanField(default=False, help_text='Restrict responses to business hours')),
                ('business_hours_start', models.TimeField(default='09:00:00', help_text='Business hours start time')),
                ('business_hours_end', models.TimeField(default='17:00:00', help_text='Business hours end time')),
                ('business_timezone', models.CharField(default='UTC', help_text='Business timezone', max_length=50)),
                ('status', models.CharField(choices=[('pending', 'Pending'), ('verified', 'Verified'), ('connected', 'Connected'), ('disconnected', 'Disconnected'), ('suspended', 'Suspended'), ('disabled', 'Disabled')], default='pending', max_length=20)),
                ('quality_rating', models.CharField(choices=[('high', 'High'), ('medium', 'Medium'), ('low', 'Low'), ('unknown', 'Unknown')], default='unknown', max_length=10)),
                ('last_health_check', models.DateTimeField(blank=True, null=True)),
                ('health_status', models.CharField(choices=[('healthy', 'Healthy'), ('unhealthy', 'Unhealthy'), ('unknown', 'Unknown')], default='unknown', max_length=20)),
                ('daily_limit', models.PositiveIntegerField(default=1000, help_text='Daily message limit')),
                ('monthly_limit', models.PositiveIntegerField(default=30000, help_text='Monthly message limit')),
                ('rate_limit_per_minute', models.PositiveIntegerField(default=10, help_text='Rate limit per minute')),
                ('messages_sent_today', models.PositiveIntegerField(default=0)),
                ('messages_sent_this_month', models.PositiveIntegerField(default=0)),
                ('last_reset_daily', models.DateField(default=django.utils.timezone.now)),
                ('last_reset_monthly', models.DateField(default=django.utils.timezone.now)),
                ('is_default', models.BooleanField(default=False, help_text='Use this provider by default')),
                ('is_active', models.BooleanField(default=True, help_text='Activate this provider')),
                ('webhook_verify_token', models.CharField(blank=True, help_text='A unique token to verify incoming webhooks', max_length=255, null=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('is_deleted', models.BooleanField(default=False)),
                ('created_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='created_whatsapp_provider', to=settings.AUTH_USER_MODEL)),
                ('updated_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='updated_whatsapp_provider', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'WhatsApp Provider',
                'verbose_name_plural': 'WhatsApp Providers',
                'db_table': 'whatsapp_provider',
                'ordering': ['-is_default', 'name'],
            },
        ),
        migrations.CreateModel(
            name='WhatsAppPhoneNumber',
            fields=[
                ('id', models.BigAutoField(primary_key=True, serialize=False)),
                ('phone_number_id', models.CharField(help_text='Phone Number ID from Meta', max_length=50)),
                ('phone_number', models.CharField(help_text='Phone number with country code', max_length=20)),
                ('display_phone_number', models.CharField(blank=True, help_text='Formatted display number', max_length=20, null=True)),
                ('status', models.CharField(choices=[('pending', 'Pending Verification'), ('verified', 'Verified'), ('failed', 'Verification Failed'), ('suspended', 'Suspended')], default='pending', max_length=20)),
                ('is_primary', models.BooleanField(default=False, help_text='Primary phone number for this WABA')),
                ('is_active', models.BooleanField(default=True)),
                ('quality_rating', models.CharField(choices=[('high', 'High'), ('medium', 'Medium'), ('low', 'Low'), ('unknown', 'Unknown')], default='unknown', max_length=10)),
                ('messages_sent_today', models.PositiveIntegerField(default=0)),
                ('messages_sent_this_month', models.PositiveIntegerField(default=0)),
                ('last_message_sent', models.DateTimeField(blank=True, null=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('verified_at', models.DateTimeField(blank=True, null=True)),
                ('provider', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, related_name='phone_numbers', to='whatsapp_provider.whatsappprovider')),
            ],
            options={
                'verbose_name': 'WhatsApp Phone Number',
                'verbose_name_plural': 'WhatsApp Phone Numbers',
                'db_table': 'whatsapp_phone_numbers',
                'ordering': ['-is_primary', '-created_at'],
                'unique_together': {('provider', 'phone_number_id')},
            },
        ),
        migrations.CreateModel(
            name='WhatsAppMessageTemplate',
            fields=[
                ('id', models.BigAutoField(primary_key=True, serialize=False)),
                ('name', models.CharField(help_text='Template name', max_length=100)),
                ('category', models.CharField(choices=[('AUTHENTICATION', 'Authentication'), ('MARKETING', 'Marketing'), ('UTILITY', 'Utility'), ('OTP', 'One-Time Password')], max_length=20)),
                ('language', models.CharField(choices=[('en_US', 'English (US)'), ('en', 'English'), ('hi', 'Hindi'), ('es', 'Spanish'), ('fr', 'French'), ('de', 'German'), ('pt', 'Portuguese'), ('ar', 'Arabic'), ('zh', 'Chinese'), ('ja', 'Japanese'), ('ko', 'Korean')], default='en', max_length=10)),
                ('header_text', models.TextField(blank=True, help_text='Header text (optional)', null=True)),
                ('body_text', models.TextField(help_text='Main message body')),
                ('footer_text', models.TextField(blank=True, help_text='Footer text (optional)', null=True)),
                ('components', models.JSONField(default=list, help_text='Template components (buttons, media, etc.)')),
                ('status', models.CharField(choices=[('pending', 'Pending Approval'), ('approved', 'Approved'), ('rejected', 'Rejected'), ('disabled', 'Disabled')], default='pending', max_length=20)),
                ('meta_template_id', models.CharField(blank=True, help_text='Template ID from Meta', max_length=100, null=True)),
                ('rejection_reason', models.TextField(blank=True, help_text='Reason for rejection if applicable', null=True)),
                ('usage_count', models.PositiveIntegerField(default=0)),
                ('last_used', models.DateTimeField(blank=True, null=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('approved_at', models.DateTimeField(blank=True, null=True)),
                ('created_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, to=settings.AUTH_USER_MODEL)),
                ('provider', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, related_name='message_templates', to='whatsapp_provider.whatsappprovider')),
            ],
            options={
                'verbose_name': 'WhatsApp Message Template',
                'verbose_name_plural': 'WhatsApp Message Templates',
                'db_table': 'whatsapp_message_templates',
                'ordering': ['-created_at'],
                'unique_together': {('provider', 'name', 'language')},
            },
        ),
        migrations.CreateModel(
            name='WhatsAppMessage',
            fields=[
                ('id', models.BigAutoField(primary_key=True, serialize=False)),
                ('message_id', models.CharField(help_text='WhatsApp message ID', max_length=100, unique=True)),
                ('direction', models.CharField(choices=[('outbound', 'Outbound'), ('inbound', 'Inbound')], max_length=10)),
                ('message_type', models.CharField(choices=[('text', 'Text Message'), ('template', 'Template Message'), ('interactive', 'Interactive Message'), ('media', 'Media Message'), ('location', 'Location Message'), ('contact', 'Contact Message')], max_length=20)),
                ('to_phone_number', models.CharField(help_text='Recipient phone number', max_length=20)),
                ('from_phone_number', models.CharField(help_text='Sender phone number', max_length=20)),
                ('content', models.JSONField(default=dict, help_text='Message content (text, media, etc.)')),
                ('status', models.CharField(choices=[('queued', 'Queued'), ('sent', 'Sent'), ('delivered', 'Delivered'), ('read', 'Read'), ('failed', 'Failed')], default='queued', max_length=20)),
                ('error_code', models.CharField(blank=True, max_length=50, null=True)),
                ('error_message', models.TextField(blank=True, null=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('sent_at', models.DateTimeField(blank=True, null=True)),
                ('delivered_at', models.DateTimeField(blank=True, null=True)),
                ('read_at', models.DateTimeField(blank=True, null=True)),
                ('metadata', models.JSONField(default=dict, help_text='Additional message metadata')),
                ('campaign', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='whatsapp_messages', to='campaigns.campaign')),
                ('customer', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='whatsapp_messages', to='customers.customer')),
                ('template', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='messages', to='whatsapp_provider.whatsappmessagetemplate')),
                ('phone_number', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='messages', to='whatsapp_provider.whatsappphonenumber')),
                ('provider', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, related_name='messages', to='whatsapp_provider.whatsappprovider')),
            ],
            options={
                'verbose_name': 'WhatsApp Message',
                'verbose_name_plural': 'WhatsApp Messages',
                'db_table': 'whatsapp_messages',
                'ordering': ['-created_at'],
            },
        ),
        migrations.CreateModel(
            name='WhatsAppFlow',
            fields=[
                ('id', models.BigAutoField(primary_key=True, serialize=False)),
                ('name', models.CharField(max_length=100)),
                ('description', models.TextField(blank=True, null=True)),
                ('flow_json', models.JSONField(help_text='Flow definition in JSON format')),
                ('status', models.CharField(choices=[('draft', 'Draft'), ('published', 'Published'), ('archived', 'Archived')], default='draft', max_length=20)),
                ('is_active', models.BooleanField(default=True)),
                ('usage_count', models.PositiveIntegerField(default=0)),
                ('last_used', models.DateTimeField(blank=True, null=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('created_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, to=settings.AUTH_USER_MODEL)),
                ('provider', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, related_name='flows', to='whatsapp_provider.whatsappprovider')),
            ],
            options={
                'verbose_name': 'WhatsApp Flow',
                'verbose_name_plural': 'WhatsApp Flows',
                'db_table': 'whatsapp_flows',
                'ordering': ['-created_at'],
            },
        ),
        migrations.CreateModel(
            name='WhatsAppAccountHealthLog',
            fields=[
                ('id', models.BigAutoField(primary_key=True, serialize=False)),
                ('health_status', models.CharField(choices=[('healthy', 'Healthy'), ('unhealthy', 'Unhealthy'), ('warning', 'Warning')], max_length=20)),
                ('check_details', models.JSONField(default=dict, help_text='Detailed health check results')),
                ('error_message', models.TextField(blank=True, null=True)),
                ('checked_at', models.DateTimeField(auto_now_add=True)),
                ('provider', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, related_name='health_logs', to='whatsapp_provider.whatsappprovider')),
            ],
            options={
                'verbose_name': 'WhatsApp Account Health Log',
                'verbose_name_plural': 'WhatsApp Account Health Logs',
                'db_table': 'whatsapp_account_health_logs',
                'ordering': ['-checked_at'],
            },
        ),
        migrations.CreateModel(
            name='WhatsAppWebhookEvent',
            fields=[
                ('id', models.BigAutoField(primary_key=True, serialize=False)),
                ('event_type', models.CharField(choices=[('message', 'Message Received'), ('message_status', 'Message Status Update'), ('account_update', 'Account Update'), ('phone_number_update', 'Phone Number Update'), ('template_status', 'Template Status Update'), ('message_template_status_update', 'Template Status Update')], max_length=50)),
                ('raw_data', models.JSONField(default=dict, help_text='Raw webhook payload')),
                ('processed', models.BooleanField(default=False)),
                ('processing_error', models.TextField(blank=True, null=True)),
                ('received_at', models.DateTimeField(auto_now_add=True)),
                ('processed_at', models.DateTimeField(blank=True, null=True)),
                ('message', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='webhook_events', to='whatsapp_provider.whatsappmessage')),
                ('provider', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, related_name='received_webhook_events', to='whatsapp_provider.whatsappprovider')),
            ],
            options={
                'verbose_name': 'WhatsApp Webhook Event',
                'verbose_name_plural': 'WhatsApp Webhook Events',
                'db_table': 'whatsapp_webhook_events',
                'ordering': ['-received_at'],
            },
        ),
        migrations.CreateModel(
            name='WhatsAppAccountUsageLog',
            fields=[
                ('id', models.BigAutoField(primary_key=True, serialize=False)),
                ('messages_sent', models.PositiveIntegerField(default=0)),
                ('messages_delivered', models.PositiveIntegerField(default=0)),
                ('messages_failed', models.PositiveIntegerField(default=0)),
                ('messages_read', models.PositiveIntegerField(default=0)),
                ('date', models.DateField(default=django.utils.timezone.now)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('provider', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, related_name='usage_logs', to='whatsapp_provider.whatsappprovider')),
            ],
            options={
                'verbose_name': 'WhatsApp Account Usage Log',
                'verbose_name_plural': 'WhatsApp Account Usage Logs',
                'db_table': 'whatsapp_account_usage_logs',
                'ordering': ['-date'],
                'unique_together': {('provider', 'date')},
            },
        ),
    ]
