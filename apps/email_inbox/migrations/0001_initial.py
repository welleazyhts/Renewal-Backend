# Generated by Django 4.2.17 on 2025-12-29 11:56

from django.conf import settings
from django.db import migrations, models
import django.db.models.deletion
import uuid


class Migration(migrations.Migration):

    initial = True

    dependencies = [
        migrations.swappable_dependency(settings.AUTH_USER_MODEL),
    ]

    operations = [
        migrations.CreateModel(
            name='EmailConversation',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('thread_id', models.CharField(max_length=255, unique=True)),
                ('subject', models.CharField(max_length=500)),
                ('participants', models.JSONField(default=list, help_text='List of email addresses in conversation')),
                ('message_count', models.PositiveIntegerField(default=0)),
                ('unread_count', models.PositiveIntegerField(default=0)),
                ('last_message_at', models.DateTimeField(blank=True, null=True)),
                ('last_message_from', models.EmailField(blank=True, max_length=254, null=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
            ],
            options={
                'verbose_name': 'Email Conversation',
                'verbose_name_plural': 'Email Conversations',
                'db_table': 'email_conversations',
                'ordering': ['-last_message_at'],
            },
        ),
        migrations.CreateModel(
            name='EmailFolder',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('name', models.CharField(max_length=100)),
                ('folder_type', models.CharField(choices=[('inbox', 'Inbox'), ('sent', 'Sent'), ('drafts', 'Drafts'), ('trash', 'Trash'), ('spam', 'Spam'), ('junk', 'Junk'), ('archive', 'Archive'), ('custom', 'Custom')], default='custom', max_length=20)),
                ('description', models.TextField(blank=True, null=True)),
                ('is_system', models.BooleanField(default=False, help_text='System-created folder')),
                ('is_active', models.BooleanField(default=True)),
                ('sort_order', models.PositiveIntegerField(default=0)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('is_deleted', models.BooleanField(default=False)),
                ('deleted_at', models.DateTimeField(blank=True, null=True)),
                ('created_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='created_email_folders', to=settings.AUTH_USER_MODEL)),
                ('deleted_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='deleted_email_folders', to=settings.AUTH_USER_MODEL)),
                ('parent', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, related_name='children', to='email_inbox.emailfolder')),
                ('updated_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='updated_email_folders', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'Email Folder',
                'verbose_name_plural': 'Email Folders',
                'db_table': 'email_folders',
                'ordering': ['sort_order', 'name'],
            },
        ),
        migrations.CreateModel(
            name='EmailInboxMessage',
            fields=[
                ('category', models.CharField(choices=[('general', 'General'), ('policy_renewal', 'Policy Renewal'), ('claim', 'Claim'), ('payment', 'Payment'), ('complaint', 'Complaint'), ('inquiry', 'Inquiry'), ('feedback', 'Feedback'), ('marketing', 'Marketing'), ('system', 'System'), ('refund', 'Refund'), ('appointment', 'Appointment'), ('uncategorized', 'Uncategorized')], default='uncategorized', max_length=20)),
                ('id', models.BigAutoField(primary_key=True, serialize=False)),
                ('message_id', models.CharField(help_text='Unique message identifier', max_length=255, unique=True)),
                ('custom_id', models.CharField(blank=True, help_text='Auto-generated ID like EMAIL-0001', max_length=50, null=True, unique=True)),
                ('from_email', models.EmailField(max_length=254)),
                ('from_name', models.CharField(blank=True, max_length=200, null=True)),
                ('to_emails', models.JSONField(blank=True, default=list, help_text='List of recipient email addresses')),
                ('cc_emails', models.JSONField(blank=True, default=list)),
                ('bcc_emails', models.JSONField(blank=True, default=list)),
                ('reply_to', models.EmailField(blank=True, max_length=254, null=True)),
                ('subject', models.CharField(max_length=500)),
                ('html_content', models.TextField(blank=True, null=True)),
                ('text_content', models.TextField(blank=True, null=True)),
                ('priority', models.CharField(choices=[('low', 'Low'), ('normal', 'Normal'), ('high', 'High'), ('urgent', 'Urgent')], default='normal', max_length=10)),
                ('sentiment', models.CharField(choices=[('positive', 'Positive'), ('neutral', 'Neutral'), ('negative', 'Negative')], default='neutral', max_length=10)),
                ('status', models.CharField(choices=[('unread', 'Unread'), ('read', 'Read'), ('replied', 'Replied'), ('forwarded', 'Forwarded'), ('archived', 'Archived'), ('deleted', 'Deleted'), ('draft', 'Draft'), ('restored', 'Restored')], default='unread', max_length=20)),
                ('is_starred', models.BooleanField(default=False)),
                ('is_important', models.BooleanField(default=False)),
                ('tags', models.JSONField(blank=True, default=list, help_text='Custom tags')),
                ('thread_id', models.CharField(blank=True, help_text='Thread identifier', max_length=255, null=True)),
                ('in_reply_to', models.CharField(blank=True, help_text='In-Reply-To header', max_length=255, null=True)),
                ('references', models.CharField(blank=True, help_text='References header', max_length=500, null=True)),
                ('received_at', models.DateTimeField(auto_now_add=True)),
                ('read_at', models.DateTimeField(blank=True, null=True)),
                ('replied_at', models.DateTimeField(blank=True, null=True)),
                ('is_spam', models.BooleanField(default=False)),
                ('is_phishing', models.BooleanField(default=False)),
                ('subcategory', models.CharField(blank=True, max_length=50, null=True)),
                ('confidence_score', models.FloatField(default=0.0)),
                ('attachments', models.JSONField(blank=True, default=list)),
                ('attachment_count', models.PositiveIntegerField(default=0)),
                ('is_processed', models.BooleanField(default=False)),
                ('processing_notes', models.TextField(blank=True, null=True)),
                ('forwarded_at', models.DateTimeField(blank=True, null=True)),
                ('raw_headers', models.JSONField(blank=True, default=dict)),
                ('raw_body', models.TextField(blank=True, null=True)),
                ('headers', models.JSONField(blank=True, default=dict)),
                ('size_bytes', models.PositiveIntegerField(default=0)),
                ('source', models.CharField(default='webhook', max_length=50)),
                ('source_message_id', models.CharField(blank=True, max_length=255, null=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('is_deleted', models.BooleanField(default=False)),
                ('deleted_at', models.DateTimeField(blank=True, null=True)),
                ('is_escalated', models.BooleanField(default=False)),
                ('escalation_reason', models.TextField(blank=True, null=True)),
                ('escalation_priority', models.CharField(blank=True, choices=[('high', 'High'), ('urgent', 'Urgent'), ('critical', 'Critical')], max_length=20, null=True)),
                ('escalated_at', models.DateTimeField(blank=True, null=True)),
                ('due_date', models.DateTimeField(blank=True, null=True)),
                ('customer_type', models.CharField(choices=[('normal', 'Normal'), ('hni', 'HNI'), ('super_hni', 'Super HNI'), ('vip', 'VIP')], default='normal', max_length=20)),
                ('assigned_to', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='assigned_emails', to=settings.AUTH_USER_MODEL)),
                ('created_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='created_email_inbox_messages', to=settings.AUTH_USER_MODEL)),
                ('deleted_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='deleted_email_inbox_messages', to=settings.AUTH_USER_MODEL)),
                ('escalated_by', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='escalated_inbox_messages', to=settings.AUTH_USER_MODEL)),
                ('folder', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='messages', to='email_inbox.emailfolder')),
                ('parent_message', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='replies', to='email_inbox.emailinboxmessage')),
                ('updated_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='updated_email_inbox_messages', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'Email Inbox Message',
                'verbose_name_plural': 'Email Inbox Messages',
                'db_table': 'email_inbox_messages',
                'ordering': ['-received_at'],
            },
        ),
        migrations.CreateModel(
            name='EmailSearchQuery',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('name', models.CharField(max_length=100)),
                ('description', models.TextField(blank=True, null=True)),
                ('query_params', models.JSONField(default=dict, help_text='Search parameters')),
                ('is_public', models.BooleanField(default=False, help_text='Available to all users')),
                ('is_active', models.BooleanField(default=True)),
                ('usage_count', models.PositiveIntegerField(default=0)),
                ('last_used', models.DateTimeField(blank=True, null=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('is_deleted', models.BooleanField(default=False)),
                ('deleted_at', models.DateTimeField(blank=True, null=True)),
                ('created_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='created_email_search_queries', to=settings.AUTH_USER_MODEL)),
                ('deleted_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='deleted_email_search_queries', to=settings.AUTH_USER_MODEL)),
                ('updated_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='updated_email_search_queries', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'Email Search Query',
                'verbose_name_plural': 'Email Search Queries',
                'db_table': 'email_search_queries',
                'ordering': ['-last_used', 'name'],
            },
        ),
        migrations.CreateModel(
            name='EmailInternalNote',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('note', models.TextField()),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('author', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, to=settings.AUTH_USER_MODEL)),
                ('email_message', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='internal_notes', to='email_inbox.emailinboxmessage')),
            ],
            options={
                'db_table': 'email_internal_notes',
                'ordering': ['-created_at'],
            },
        ),
        migrations.CreateModel(
            name='EmailFilter',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('name', models.CharField(max_length=100)),
                ('description', models.TextField(blank=True, null=True)),
                ('filter_type', models.CharField(choices=[('subject', 'Subject'), ('from', 'From'), ('to', 'To'), ('body', 'Body'), ('category', 'Category'), ('priority', 'Priority')], max_length=20)),
                ('operator', models.CharField(choices=[('contains', 'Contains'), ('not_contains', 'Does not contain'), ('equals', 'Equals'), ('not_equals', 'Does not equal'), ('starts_with', 'Starts with'), ('ends_with', 'Ends with'), ('regex', 'Regular expression')], max_length=20)),
                ('value', models.CharField(max_length=500)),
                ('action', models.CharField(choices=[('move_to_folder', 'Move to folder'), ('mark_as_read', 'Mark as read'), ('mark_as_important', 'Mark as important'), ('add_tag', 'Add tag'), ('assign_to', 'Assign to user'), ('auto_reply', 'Auto reply'), ('forward', 'Forward')], max_length=20)),
                ('action_value', models.CharField(blank=True, help_text='Action parameter (folder name, tag, etc.)', max_length=500, null=True)),
                ('is_active', models.BooleanField(default=True)),
                ('is_system', models.BooleanField(default=False, help_text='System-created filter')),
                ('priority', models.PositiveIntegerField(default=0, help_text='Filter priority (higher = processed first)')),
                ('match_count', models.PositiveIntegerField(default=0)),
                ('last_matched', models.DateTimeField(blank=True, null=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('is_deleted', models.BooleanField(default=False)),
                ('deleted_at', models.DateTimeField(blank=True, null=True)),
                ('created_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='created_email_filters', to=settings.AUTH_USER_MODEL)),
                ('deleted_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='deleted_email_filters', to=settings.AUTH_USER_MODEL)),
                ('updated_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='updated_email_filters', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'Email Filter',
                'verbose_name_plural': 'Email Filters',
                'db_table': 'email_filters',
                'ordering': ['-priority', 'name'],
            },
        ),
        migrations.CreateModel(
            name='EmailAuditLog',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('action', models.CharField(help_text="e.g., 'Viewed', 'Escalated', 'Category Changed'", max_length=50)),
                ('details', models.TextField(blank=True, help_text="Extra info like 'Changed from Normal to VIP'", null=True)),
                ('timestamp', models.DateTimeField(auto_now_add=True)),
                ('email_message', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='audit_logs', to='email_inbox.emailinboxmessage')),
                ('performed_by', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'db_table': 'email_audit_logs',
                'ordering': ['-timestamp'],
            },
        ),
        migrations.CreateModel(
            name='EmailAttachment',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('filename', models.CharField(max_length=255)),
                ('content_type', models.CharField(max_length=100)),
                ('file_size', models.PositiveIntegerField(help_text='File size in bytes')),
                ('file_path', models.CharField(help_text='Path to stored file', max_length=500)),
                ('is_safe', models.BooleanField(default=True, help_text='File passed security scan')),
                ('scan_result', models.JSONField(blank=True, default=dict, help_text='Security scan results')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('created_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='created_email_attachments', to=settings.AUTH_USER_MODEL)),
                ('email_message', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='email_attachments', to='email_inbox.emailinboxmessage')),
            ],
            options={
                'verbose_name': 'Email Attachment',
                'verbose_name_plural': 'Email Attachments',
                'db_table': 'email_attachments',
                'ordering': ['filename'],
            },
        ),
        migrations.CreateModel(
            name='BulkEmailCampaign',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('name', models.CharField(max_length=200)),
                ('subject_template', models.CharField(help_text='Base subject from template', max_length=500)),
                ('body_html_template', models.TextField(help_text='Base HTML from template')),
                ('custom_subject', models.CharField(blank=True, help_text="User's custom subject override", max_length=500, null=True)),
                ('additional_message', models.TextField(blank=True, help_text="User's additional note", null=True)),
                ('recipients_data', models.JSONField(default=list, help_text="List of dicts: [{'email': 'x', 'name': 'y', 'company': 'z'}]")),
                ('scheduled_at', models.DateTimeField(blank=True, null=True)),
                ('sent_at', models.DateTimeField(blank=True, null=True)),
                ('status', models.CharField(choices=[('unread', 'Unread'), ('read', 'Read'), ('replied', 'Replied'), ('forwarded', 'Forwarded'), ('archived', 'Archived'), ('deleted', 'Deleted'), ('draft', 'Draft'), ('restored', 'Restored'), ('failed', 'Failed')], default='draft', max_length=20)),
                ('total_recipients', models.IntegerField(default=0)),
                ('successful_sends', models.IntegerField(default=0)),
                ('failed_sends', models.IntegerField(default=0)),
                ('opened_count', models.IntegerField(default=0)),
                ('clicked_count', models.IntegerField(default=0)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('created_by', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'db_table': 'bulk_email_campaigns',
                'ordering': ['-created_at'],
            },
        ),
        migrations.AddIndex(
            model_name='emailinboxmessage',
            index=models.Index(fields=['status', 'priority'], name='email_inbox_status_8f4d65_idx'),
        ),
        migrations.AddIndex(
            model_name='emailinboxmessage',
            index=models.Index(fields=['category', 'status'], name='email_inbox_categor_78abd3_idx'),
        ),
        migrations.AddIndex(
            model_name='emailinboxmessage',
            index=models.Index(fields=['from_email', 'received_at'], name='email_inbox_from_em_e7b9ed_idx'),
        ),
        migrations.AddIndex(
            model_name='emailinboxmessage',
            index=models.Index(fields=['thread_id', 'received_at'], name='email_inbox_thread__05adaa_idx'),
        ),
        migrations.AddIndex(
            model_name='emailinboxmessage',
            index=models.Index(fields=['is_starred', 'received_at'], name='email_inbox_is_star_014893_idx'),
        ),
        migrations.AlterUniqueTogether(
            name='emailfolder',
            unique_together={('name', 'parent')},
        ),
    ]
